(function(){"use strict";var e={318:function(e,t,n){var o=n(688),a=n(768),r=n(187);const c={id:"app"},i={class:"container"},s={key:0,class:"message"};function l(e,t,n,o,l,u){const m=(0,a.g2)("LoveButton"),d=(0,a.g2)("LoginForm"),v=(0,a.g2)("MessageBoard");return(0,a.uX)(),(0,a.CE)("div",c,[o.currentUser?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"user-info",onClick:t[0]||(t[0]=(...e)=>o.logout&&o.logout(...e))}," 欢迎, "+(0,r.v_)(o.currentUser)+" | 点击退出 ",1)):(0,a.Q3)("",!0),(0,a.Lk)("div",i,[(0,a.bF)(m,{onLoveClicked:o.handleLoveClick,count:o.loveCount},null,8,["onLoveClicked","count"]),o.showLoveMessage?((0,a.uX)(),(0,a.CE)("div",s,"We Love Grace! ❤️")):(0,a.Q3)("",!0),o.currentUser?((0,a.uX)(),(0,a.Wv)(v,{key:2,user:o.currentUser},null,8,["user"])):((0,a.uX)(),(0,a.Wv)(d,{key:1,onLogin:o.handleLogin},null,8,["onLogin"]))])])}const u={class:"counter"};function m(e,t,n,o,c,i){return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>i.handleClick&&i.handleClick(...e)),class:"love-button"}," 点击这里 "),(0,a.Lk)("div",u," 已有 "+(0,r.v_)(n.count)+" 人表达爱意 ",1)])}var d={name:"LoveButton",props:{count:{type:Number,default:0}},emits:["love-clicked"],methods:{handleClick(){this.$emit("love-clicked")}}},v=n(241);const p=(0,v.A)(d,[["render",m],["__scopeId","data-v-7a1bf45e"]]);var g=p;const f=e=>((0,a.Qi)("data-v-de969026"),e=e(),(0,a.jt)(),e),h={class:"login-form"},k=f(()=>(0,a.Lk)("h2",null,"欢迎来到 Grace 的留言板",-1)),y=f(()=>(0,a.Lk)("p",null,"请先输入您的用户名",-1));function C(e,t,n,r,c,i){return(0,a.uX)(),(0,a.CE)("div",h,[k,y,(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.username=e),type:"text",placeholder:"用户名",onKeyup:t[1]||(t[1]=(0,o.jR)((...e)=>r.handleLogin&&r.handleLogin(...e),["enter"])),required:""},null,544),[[o.Jo,r.username]]),(0,a.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>r.handleLogin&&r.handleLogin(...e))},"登录")])}var L=n(798),w={name:"LoginForm",emits:["login"],setup(e,{emit:t}){const n=(0,L.KR)(""),o=()=>{""!==n.value.trim()?(t("login",n.value.trim()),n.value=""):alert("请输入用户名")};return{username:n,handleLogin:o}}};const E=(0,v.A)(w,[["render",C],["__scopeId","data-v-de969026"]]);var j=E;const b=e=>((0,a.Qi)("data-v-cd851aec"),e=e(),(0,a.jt)(),e),_={class:"message-board"},X=b(()=>(0,a.Lk)("h2",null,"Grace 的留言板",-1)),S={class:"comment-form"},I={class:"media-buttons"},M={key:1,class:"media-preview"},P=["src"],O=["src"],U={class:"comments-container"};function K(e,t,n,r,c,i){const s=(0,a.g2)("EmojiPicker"),l=(0,a.g2)("CommentItem");return(0,a.uX)(),(0,a.CE)("div",_,[X,(0,a.Lk)("div",S,[(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.commentText=e),placeholder:"写下你的留言..."},null,512),[[o.Jo,r.commentText]]),(0,a.Lk)("div",I,[(0,a.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>r.toggleEmojiPicker&&r.toggleEmojiPicker(...e))},"添加表情"),(0,a.Lk)("input",{ref:"mediaInput",type:"file",accept:"image/*,video/*",onChange:t[2]||(t[2]=(...e)=>r.handleMediaSelect&&r.handleMediaSelect(...e)),style:{display:"none"}},null,544),(0,a.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>r.selectMedia&&r.selectMedia(...e))},"添加图片/视频")]),r.showEmojiPicker?((0,a.uX)(),(0,a.Wv)(s,{key:0,onEmojiSelected:r.addEmoji},null,8,["onEmojiSelected"])):(0,a.Q3)("",!0),r.selectedFile?((0,a.uX)(),(0,a.CE)("div",M,[r.isImage?((0,a.uX)(),(0,a.CE)("img",{key:0,src:r.mediaPreview,alt:"预览"},null,8,P)):r.isVideo?((0,a.uX)(),(0,a.CE)("video",{key:1,src:r.mediaPreview,controls:""},null,8,O)):(0,a.Q3)("",!0),(0,a.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>r.removeMedia&&r.removeMedia(...e)),class:"remove-media"},"移除")])):(0,a.Q3)("",!0),(0,a.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>r.postComment&&r.postComment(...e)),class:"post-button"},"发布留言")]),(0,a.Lk)("div",U,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.comments,e=>((0,a.uX)(),(0,a.Wv)(l,{key:e._id||e.timestamp,comment:e},null,8,["comment"]))),128))])])}const R={class:"comment"},F={class:"comment-header"},W={class:"username"},$={class:"timestamp"},x={class:"comment-content"},Q={key:0,class:"comment-media"},T=["src"],A=["src"];function B(e,t,n,o,c,i){return(0,a.uX)(),(0,a.CE)("div",R,[(0,a.Lk)("div",F,[(0,a.Lk)("span",W,(0,r.v_)(n.comment.username),1),(0,a.Lk)("span",$,(0,r.v_)(o.formattedDate),1)]),(0,a.Lk)("div",x,(0,r.v_)(n.comment.content),1),n.comment.mediaUrl?((0,a.uX)(),(0,a.CE)("div",Q,["image"===n.comment.mediaType?((0,a.uX)(),(0,a.CE)("img",{key:0,src:n.comment.mediaUrl,alt:"用户上传图片"},null,8,T)):"video"===n.comment.mediaType?((0,a.uX)(),(0,a.CE)("video",{key:1,src:n.comment.mediaUrl,controls:""},null,8,A)):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0)])}var D={name:"CommentItem",props:{comment:{type:Object,required:!0}},setup(e){const t=(0,L.EW)(()=>{const t=new Date(e.comment.timestamp);return`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`});return{formattedDate:t}}};const V=(0,v.A)(D,[["render",B],["__scopeId","data-v-491efef9"]]);var q=V;const G={class:"emoji-picker"},z=["onClick"];function J(e,t,n,o,c,i){return(0,a.uX)(),(0,a.CE)("div",G,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(c.emojis,e=>((0,a.uX)(),(0,a.CE)("span",{key:e,class:"emoji",onClick:t=>i.selectEmoji(e)},(0,r.v_)(e),9,z))),128))])}var H={name:"EmojiPicker",emits:["emoji-selected"],data(){return{emojis:["😊","❤️","👍","🎉","🌹","🥰","😍","🤗","🐟"]}},methods:{selectEmoji(e){this.$emit("emoji-selected",e)}}};const N=(0,v.A)(H,[["render",J],["__scopeId","data-v-1de4947e"]]);var Y=N;const Z="/api";async function ee(){try{const e=await fetch(`${Z}/love/count`),t=await e.json();return t.count}catch(e){throw console.error("获取爱心计数失败:",e),e}}async function te(){try{const e=await fetch(`${Z}/love/increment`,{method:"POST"}),t=await e.json();return t.count}catch(e){throw console.error("增加爱心计数失败:",e),e}}async function ne(){try{const e=await fetch(`${Z}/comments`),t=await e.json();return t}catch(e){throw console.error("获取留言失败:",e),e}}async function oe({username:e,content:t,media:n}){try{const o=new FormData;o.append("username",e),o.append("content",t),n&&o.append("media",n);const a=await fetch(`${Z}/comments`,{method:"POST",body:o});if(!a.ok)throw new Error("发布留言失败");return await a.json()}catch(o){throw console.error("发布留言失败:",o),o}}var ae={name:"MessageBoard",components:{CommentItem:q,EmojiPicker:Y},props:{user:{type:String,required:!0}},setup(e){const t=(0,L.KR)(""),n=(0,L.KR)([]),o=(0,L.KR)(!1),r=(0,L.KR)(null),c=(0,L.KR)(""),i=(0,L.KR)(null),s=(0,L.EW)(()=>r.value&&r.value.type.startsWith("image/")),l=(0,L.EW)(()=>r.value&&r.value.type.startsWith("video/")),u=async()=>{try{const e=await ne();n.value=e}catch(e){console.error("加载留言失败:",e)}},m=()=>{o.value=!o.value},d=e=>{t.value+=e,o.value=!1},v=()=>{i.value.click()},p=e=>{const t=e.target.files[0];if(!t)return;if(t.type.startsWith("image/")&&t.size>5242880)return void alert("图片大小不能超过5MB");if(t.type.startsWith("video/")&&t.size>20971520)return void alert("视频大小不能超过20MB");r.value=t;const n=new FileReader;n.onload=e=>{c.value=e.target.result},n.readAsDataURL(t)},g=()=>{r.value=null,c.value="",i.value.value=""},f=async()=>{if(t.value.trim()||r.value)try{await oe({username:e.user,content:t.value.trim(),media:r.value}),t.value="",g(),await u()}catch(n){console.error("发布留言失败:",n),alert("发布留言失败，请重试")}else alert("请输入留言内容或添加媒体文件")};return(0,a.sV)(()=>{u()}),{commentText:t,comments:n,showEmojiPicker:o,selectedFile:r,mediaPreview:c,mediaInput:i,isImage:s,isVideo:l,toggleEmojiPicker:m,addEmoji:d,selectMedia:v,handleMediaSelect:p,removeMedia:g,postComment:f}}};const re=(0,v.A)(ae,[["render",K],["__scopeId","data-v-cd851aec"]]);var ce=re,ie={name:"App",components:{LoveButton:g,LoginForm:j,MessageBoard:ce},setup(){const e=(0,L.KR)(localStorage.getItem("graceUsername")),t=(0,L.KR)(0),n=(0,L.KR)(!1),o=async()=>{try{const e=await ee();t.value=e}catch(e){console.error("获取爱心计数失败:",e)}},r=async()=>{try{const e=await te();t.value=e,n.value=!n.value}catch(e){console.error("增加爱心计数失败:",e)}},c=t=>{e.value=t,localStorage.setItem("graceUsername",t)},i=()=>{localStorage.removeItem("graceUsername"),e.value=null};return(0,a.sV)(()=>{o()}),{currentUser:e,loveCount:t,showLoveMessage:n,handleLoveClick:r,handleLogin:c,logout:i}}};const se=(0,v.A)(ie,[["render",l],["__scopeId","data-v-1e57fc4a"]]);var le=se;const ue=(0,o.Ef)(le);ue.mount("#app")}},t={};function n(o){var a=t[o];if(void 0!==a)return a.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}n.m=e,function(){var e=[];n.O=function(t,o,a,r){if(!o){var c=1/0;for(u=0;u<e.length;u++){o=e[u][0],a=e[u][1],r=e[u][2];for(var i=!0,s=0;s<o.length;s++)(!1&r||c>=r)&&Object.keys(n.O).every(function(e){return n.O[e](o[s])})?o.splice(s--,1):(i=!1,r<c&&(c=r));if(i){e.splice(u--,1);var l=a();void 0!==l&&(t=l)}}return t}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[o,a,r]}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,o){var a,r,c=o[0],i=o[1],s=o[2],l=0;if(c.some(function(t){return 0!==e[t]})){for(a in i)n.o(i,a)&&(n.m[a]=i[a]);if(s)var u=s(n)}for(t&&t(o);l<c.length;l++)r=c[l],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(u)},o=self["webpackChunkwe_love_grace"]=self["webpackChunkwe_love_grace"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[504],function(){return n(318)});o=n.O(o)})();
//# sourceMappingURL=app.ecd640b5.js.map